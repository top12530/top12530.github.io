<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>币安加密货币趋势分析系统</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3B82F6',
            secondary: '#10B981',
            accent: '#8B5CF6',
            'ma3-color': '#F59E0B',
            'bullish': '#10B981',
            'bearish': '#EF4444',
            'neutral': '#6B7280',
            neutral: '#1F2937',
            'neutral-light': '#F3F4F6',
          },
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-shadow {
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
      }
      .chart-container {
        position: relative;
        height: 350px;
      }
      .table-container {
        overflow-x: auto;
      }
      .price-up {
        color: #10B981;
      }
      .price-down {
        color: #EF4444;
      }
      .trend-indicator {
        transition: all 0.5s ease;
      }
      .trend-indicator.bullish {
        background-color: rgba(16, 185, 129, 0.1);
        border-left: 4px solid #10B981;
      }
      .trend-indicator.bearish {
        background-color: rgba(239, 68, 68, 0.1);
        border-left: 4px solid #EF4444;
      }
      .trend-indicator.neutral {
        background-color: rgba(107, 114, 128, 0.1);
        border-left: 4px solid #6B7280;
      }
      .order-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .order-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px -5px rgba(0, 0, 0, 0.1);
      }
      .symbol-input {
        transition: all 0.3s ease;
        min-width: 200px;
      }
      .symbol-input:focus {
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
      }
      .confidence-bar {
        transition: width 0.5s ease;
      }
    }
  </style>
</head>
<body class="bg-gray-50 font-inter text-neutral">
  <div class="container mx-auto px-4 py-8 max-w-7xl">
    <header class="mb-8 text-center">
      <h1 class="text-[clamp(1.8rem,5vw,2.5rem)] font-bold text-neutral mb-2">
        <i class="fa fa-line-chart text-primary mr-2"></i>币安加密货币趋势分析系统
      </h1>
      <p class="text-gray-600 max-w-2xl mx-auto">实时分析加密货币价格数据，使用多指标综合判断趋势，提高交易决策准确性</p>
    </header>

    <!-- 交易对输入区域 -->
    <div class="bg-white rounded-xl p-6 card-shadow mb-8">
      <div class="flex flex-col md:flex-row justify-between items-center mb-6">
        <div class="mb-4 md:mb-0">
          <h2 class="text-xl font-bold mb-3">选择加密货币交易对</h2>
          <div class="flex flex-col sm:flex-row sm:items-center gap-3">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">输入交易对（如 BTCUSDT）</label>
              <div class="flex">
                <input 
                  type="text" 
                  id="symbol-input" 
                  placeholder="BTCUSDT" 
                  class="symbol-input px-4 py-2 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                  value="BTCUSDT"
                >
                <button id="fetch-btn" class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-r-lg transition-all duration-300 flex items-center">
                  <i class="fa fa-search mr-2"></i>获取数据
                </button>
              </div>
            </div>
            <div class="flex items-center">
              <span class="text-sm text-gray-500 mr-2">示例：</span>
              <div class="flex flex-wrap gap-2">
                <button class="symbol-example px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded transition-colors" data-symbol="BTCUSDT">BTC/USDT</button>
                <button class="symbol-example px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded transition-colors" data-symbol="ETHUSDT">ETH/USDT</button>
                <button class="symbol-example px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded transition-colors" data-symbol="BNBUSDT">BNB/USDT</button>
                <button class="symbol-example px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded transition-colors" data-symbol="SOLUSDT">SOL/USDT</button>
              </div>
            </div>
          </div>
        </div>
        <div class="flex space-x-3">
          <button id="refresh-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-lg transition-all duration-300 flex items-center">
            <i class="fa fa-refresh mr-2"></i>刷新数据
          </button>
        </div>
      </div>
      
      <div class="mt-4 bg-blue-50 border-l-4 border-primary p-4 rounded">
        <div class="flex">
          <div class="flex-shrink-0">
            <i class="fa fa-info-circle text-primary text-xl"></i>
          </div>
          <div class="ml-3">
            <p class="text-sm text-blue-700">
              输入币安支持的交易对，如 BTCUSDT、ETHUSDT 等。系统将获取该交易对近30天的价格数据进行多指标综合分析。
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-xl p-6 card-shadow mb-8">
      <div class="flex flex-col md:flex-row justify-between items-center mb-6">
        <div class="mb-4 md:mb-0">
          <h2 class="text-xl font-bold mb-1"><span id="current-symbol">BTC/USDT</span> 价格趋势分析</h2>
          <p class="text-sm text-gray-500" id="data-time">数据更新时间：加载中...</p>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
        <div class="lg:col-span-2">
          <div class="chart-container">
            <canvas id="priceChart"></canvas>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="volumeChart"></canvas>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
      <div class="bg-white rounded-xl p-6 card-shadow">
        <div class="flex items-center mb-4">
          <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-ma3-color">
            <i class="fa fa-arrows-h"></i>
          </div>
          <div class="ml-3">
            <h3 class="font-semibold text-lg">MA3 均线</h3>
            <p class="text-sm text-gray-500">超短期趋势指标</p>
          </div>
        </div>
        <p class="text-2xl font-bold" id="ma3-value">--</p>
        <div class="mt-3 text-sm" id="ma3-change">
          <span class="text-gray-500">较昨日: </span>
          <span class="text-red-500">-0.00%</span>
        </div>
      </div>

      <div class="bg-white rounded-xl p-6 card-shadow">
        <div class="flex items-center mb-4">
          <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-primary">
            <i class="fa fa-arrows-h"></i>
          </div>
          <div class="ml-3">
            <h3 class="font-semibold text-lg">MA5 均线</h3>
            <p class="text-sm text-gray-500">短期趋势指标</p>
          </div>
        </div>
        <p class="text-2xl font-bold" id="ma5-value">--</p>
        <div class="mt-3 text-sm" id="ma5-change">
          <span class="text-gray-500">较昨日: </span>
          <span class="text-red-500">-0.00%</span>
        </div>
      </div>

      <div class="bg-white rounded-xl p-6 card-shadow">
        <div class="flex items-center mb-4">
          <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-secondary">
            <i class="fa fa-arrows-h"></i>
          </div>
          <div class="ml-3">
            <h3 class="font-semibold text-lg">MA20 均线</h3>
            <p class="text-sm text-gray-500">中期趋势指标</p>
          </div>
        </div>
        <p class="text-2xl font-bold" id="ma20-value">--</p>
        <div class="mt-3 text-sm" id="ma20-change">
          <span class="text-gray-500">较昨日: </span>
          <span class="text-green-500">+0.00%</span>
        </div>
      </div>

      <div class="bg-white rounded-xl p-6 card-shadow">
        <div class="flex items-center mb-4">
          <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center text-accent">
            <i class="fa fa-arrows-h"></i>
          </div>
          <div class="ml-3">
            <h3 class="font-semibold text-lg">MA30 均线</h3>
            <p class="text-sm text-gray-500">长期趋势指标</p>
          </div>
        </div>
        <p class="text-2xl font-bold" id="ma30-value">--</p>
        <div class="mt-3 text-sm" id="ma30-change">
          <span class="text-gray-500">较昨日: </span>
          <span class="text-green-500">+0.00%</span>
        </div>
      </div>
    </div>

    <div class="trend-indicator p-6 rounded-xl mb-8 transition-all duration-500" id="trend-indicator">
      <div class="flex items-center justify-between">
        <div>
          <h3 class="text-xl font-bold mb-1" id="trend-title">趋势判断</h3>
          <p class="text-sm text-gray-500" id="trend-description">计算中...</p>
        </div>
        <div class="text-4xl font-bold" id="trend-status">--</div>
      </div>
      
      <!-- 新增技术指标确认区域 -->
      <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-white p-4 rounded-lg">
          <h4 class="text-sm font-medium text-gray-500 mb-1">技术指标确认</h4>
          <div class="space-y-1 text-sm">
            <div class="flex justify-between">
              <span>RSI:</span>
              <span id="rsi-value" class="font-medium">--</span>
            </div>
            <div class="flex justify-between">
              <span>MACD:</span>
              <span id="macd-status" class="font-medium">--</span>
            </div>
            <div class="flex justify-between">
              <span>成交量确认:</span>
              <span id="volume-confirm" class="font-medium">--</span>
            </div>
          </div>
        </div>
        
        <div class="bg-white p-4 rounded-lg">
          <h4 class="text-sm font-medium text-gray-500 mb-1">趋势置信度</h4>
          <div class="flex items-center">
            <div class="w-full bg-gray-200 rounded-full h-2.5">
              <div id="confidence-bar" class="confidence-bar bg-green-600 h-2.5 rounded-full" style="width: 0%"></div>
            </div>
            <span id="confidence-value" class="ml-2 text-sm font-medium">0%</span>
          </div>
          <div class="mt-2 text-xs text-gray-500" id="confidence-description">基于多指标综合计算</div>
        </div>
        
        <div class="bg-white p-4 rounded-lg">
          <h4 class="text-sm font-medium text-gray-500 mb-1">风险管理</h4>
          <div class="space-y-1 text-sm">
            <div class="flex justify-between">
              <span>波动率:</span>
              <span id="volatility" class="font-medium">--</span>
            </div>
            <div class="flex justify-between">
              <span>ATR:</span>
              <span id="atr-value" class="font-medium">--</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="mt-4 grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="bg-white p-4 rounded-lg">
          <h4 class="text-sm font-medium text-gray-500 mb-1">多头趋势条件</h4>
          <p class="text-sm" id="bullish-condition">均线多头排列 + RSI健康 + MACD金叉 + 成交量确认</p>
          <div class="mt-2 text-xs text-gray-500" id="bullish-met">未满足</div>
        </div>
        <div class="bg-white p-4 rounded-lg">
          <h4 class="text-sm font-medium text-gray-500 mb-1">空头趋势条件</h4>
          <p class="text-sm" id="bearish-condition">均线空头排列 + RSI健康 + MACD死叉 + 成交量确认</p>
          <div class="mt-2 text-xs text-gray-500" id="bearish-met">未满足</div>
        </div>
        <div class="bg-white p-4 rounded-lg">
          <h4 class="text-sm font-medium text-gray-500 mb-1">做多挂单价</h4>
          <p class="text-lg font-semibold text-bullish" id="long-order-price">--</p>
          <p class="text-xs text-gray-500" id="long-order-description">动态计算</p>
        </div>
        <div class="bg-white p-4 rounded-lg">
          <h4 class="text-sm font-medium text-gray-500 mb-1">做空挂单价</h4>
          <p class="text-lg font-semibold text-bearish" id="short-order-price">--</p>
          <p class="text-xs text-gray-500" id="short-order-description">动态计算</p>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <div class="bg-white rounded-xl p-6 card-shadow order-card">
        <div class="flex items-center mb-4">
          <div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-bullish">
            <i class="fa fa-arrow-up"></i>
          </div>
          <div class="ml-3">
            <h3 class="font-semibold text-lg">做多挂单策略</h3>
            <p class="text-sm text-gray-500">动态支撑位 + ATR调整</p>
          </div>
        </div>
        <div class="mt-4">
          <p class="text-sm text-gray-600 mb-2">基于支撑位和ATR动态计算挂单价，结合趋势判断提高入场成功率。</p>
          <div class="bg-green-50 p-3 rounded-lg">
            <p class="font-medium text-bullish">当前挂单价: <span id="long-order-display" class="text-xl">--</span></p>
            <p class="text-xs text-gray-500 mt-1" id="long-stop-loss">止损价: --</p>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl p-6 card-shadow order-card">
        <div class="flex items-center mb-4">
          <div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-bearish">
            <i class="fa fa-arrow-down"></i>
          </div>
          <div class="ml-3">
            <h3 class="font-semibold text-lg">做空挂单策略</h3>
            <p class="text-sm text-gray-500">动态阻力位 + ATR调整</p>
          </div>
        </div>
        <div class="mt-4">
          <p class="text-sm text-gray-600 mb-2">基于阻力位和ATR动态计算挂单价，结合趋势判断提高入场成功率。</p>
          <div class="bg-red-50 p-3 rounded-lg">
            <p class="font-medium text-bearish">当前挂单价: <span id="short-order-display" class="text-xl">--</span></p>
            <p class="text-xs text-gray-500 mt-1" id="short-stop-loss">止损价: --</p>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-white rounded-xl p-6 card-shadow mb-8">
      <div class="flex flex-col md:flex-row justify-between items-center mb-6">
        <h2 class="text-xl font-bold mb-4 md:mb-0">最近30天价格与成交量数据</h2>
        <div class="flex space-x-2">
          <button id="toggle-volume-btn" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors">
            <i class="fa fa-area-chart mr-1"></i>成交量
          </button>
        </div>
      </div>
      
      <div class="table-container">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">日期</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">开盘价</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">最高价</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">最低价</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">收盘价</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">涨跌幅</th>
              <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider volume-column">成交量</th>
            </tr>
          </thead>
          <tbody id="price-table-body" class="bg-white divide-y divide-gray-200">
            <!-- 表格内容将通过JavaScript动态生成 -->
          </tbody>
        </table>
      </div>
    </div>

    <div class="bg-white rounded-xl p-6 card-shadow">
      <h2 class="text-xl font-bold mb-4">多指标分析说明</h2>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div class="bg-orange-50 rounded-lg p-4">
          <h3 class="font-semibold text-ma3-color mb-2">MA3 均线</h3>
          <p class="text-sm text-gray-600">由最近3天的收盘价计算得出，反映超短期价格趋势，敏感度极高，适合极短期交易决策参考。</p>
        </div>
        <div class="bg-blue-50 rounded-lg p-4">
          <h3 class="font-semibold text-primary mb-2">MA5 均线</h3>
          <p class="text-sm text-gray-600">由最近5天的收盘价计算得出，反映短期价格趋势，敏感度高，适合短期交易决策参考。</p>
        </div>
        <div class="bg-green-50 rounded-lg p-4">
          <h3 class="font-semibold text-secondary mb-2">MA20 均线</h3>
          <p class="text-sm text-gray-600">由最近20天的收盘价计算得出，反映中期价格趋势，能够过滤短期波动，适合中期持仓参考。</p>
        </div>
        <div class="bg-purple-50 rounded-lg p-4">
          <h3 class="font-semibold text-accent mb-2">MA30 均线</h3>
          <p class="text-sm text-gray-600">由最近30天的收盘价计算得出，反映长期价格趋势，稳定性强，适合长期投资者判断大趋势。</p>
        </div>
      </div>
      
      <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="bg-yellow-50 rounded-lg p-4">
          <h3 class="font-semibold text-yellow-600 mb-2">RSI 指标</h3>
          <p class="text-sm text-gray-600">相对强弱指数，衡量价格变动速度和幅度，用于判断超买超卖状态。通常RSI>70为超买，RSI<30为超卖。</p>
        </div>
        <div class="bg-indigo-50 rounded-lg p-4">
          <h3 class="font-semibold text-indigo-600 mb-2">MACD 指标</h3>
          <p class="text-sm text-gray-600">移动平均收敛散度，通过短期和长期EMA的差异判断趋势强度和方向。MACD线上穿信号线为金叉，下穿为死叉。</p>
        </div>
        <div class="bg-pink-50 rounded-lg p-4">
          <h3 class="font-semibold text-pink-600 mb-2">ATR 指标</h3>
          <p class="text-sm text-gray-600">平均真实波幅，衡量价格波动性，用于设置止损和挂单距离。ATR值越大，市场波动性越高。</p>
        </div>
      </div>
      
      <div class="mt-4 bg-gray-50 rounded-lg p-4">
        <h3 class="font-semibold text-gray-700 mb-2">趋势判断说明</h3>
        <ul class="text-sm text-gray-600 space-y-2">
          <li><span class="text-bullish font-medium">多头趋势：</span> 均线多头排列(MA3>MA5>MA20) + RSI在50-70健康区间 + MACD金叉 + 成交量确认 + MA30斜率>15°</li>
          <li><span class="text-bearish font-medium">空头趋势：</span> 均线空头排列(MA3<MA5<MA20) + RSI在30-50健康区间 + MACD死叉 + 成交量确认 + MA30斜率<-15°</li>
          <li><span class="text-neutral font-medium">震荡趋势：</span> 不满足上述条件</li>
        </ul>
        <div class="mt-4">
          <h3 class="font-semibold text-gray-700 mb-2">挂单策略说明</h3>
          <ul class="text-sm text-gray-600 space-y-2">
            <li><span class="text-bullish font-medium">做多挂单价：</span> 动态支撑位 - ATR × 0.5（基于ATR动态调整，避免固定百分比）</li>
            <li><span class="text-bearish font-medium">做空挂单价：</span> 动态阻力位 + ATR × 0.3（基于ATR动态调整，避免固定百分比）</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <footer class="bg-neutral text-white py-8 mt-12">
    <div class="container mx-auto px-4 max-w-5xl">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          <h3 class="text-lg font-semibold mb-2">币安加密货币价格均线分析 - 增强版</h3>
          <p class="text-gray-400 text-sm">数据来源于 Binance Public API | 多指标综合分析</p>
        </div>
        <div class="flex space-x-4">
          <a href="#" class="text-gray-400 hover:text-white transition-colors">
            <i class="fa fa-github text-xl"></i>
          </a>
          <a href="#" class="text-gray-400 hover:text-white transition-colors">
            <i class="fa fa-twitter text-xl"></i>
          </a>
          <a href="#" class="text-gray-400 hover:text-white transition-colors">
            <i class="fa fa-linkedin text-xl"></i>
          </a>
        </div>
      </div>
      <div class="border-t border-gray-700 mt-6 pt-6 text-center text-gray-400 text-sm">
        <p>© 2025 币安加密货币价格均线分析 - 增强版 | 仅供参考，不构成投资建议</p>
      </div>
    </div>
  </footer>

  <script>
    // 初始化图表
    let priceChart;
    let volumeChart;
    let priceData = [];
    let dateLabels = [];
    let volumeData = [];
    let showVolumeColumn = true;
    let currentSymbol = 'BTCUSDT'; // 当前选中的交易对
    
    // DOM 加载完成后执行
    document.addEventListener('DOMContentLoaded', () => {
      // 初始化页面时获取默认交易对数据
      fetchPriceData();
      
      // 添加事件监听器
      document.getElementById('fetch-btn').addEventListener('click', () => {
        const symbolInput = document.getElementById('symbol-input').value.trim().toUpperCase();
        if (symbolInput) {
          currentSymbol = symbolInput;
          fetchPriceData();
        } else {
          alert('请输入交易对');
        }
      });
      
      document.getElementById('refresh-btn').addEventListener('click', fetchPriceData);
      document.getElementById('toggle-volume-btn').addEventListener('click', toggleVolumeColumn);
      
      // 示例交易对按钮事件
      document.querySelectorAll('.symbol-example').forEach(button => {
        button.addEventListener('click', () => {
          const symbol = button.getAttribute('data-symbol');
          document.getElementById('symbol-input').value = symbol;
          currentSymbol = symbol;
          fetchPriceData();
        });
      });
    });
    
    // 获取价格数据
    async function fetchPriceData() {
      try {
        showLoading(true);
        
        // 更新标题中的交易对显示
        document.getElementById('current-symbol').textContent = formatSymbolDisplay(currentSymbol);
        
        // 从币安API获取交易对近30天K线数据
        const response = await fetch(`https://data-api.binance.vision/api/v3/klines?symbol=${currentSymbol}&interval=1d&limit=31`);
        
        if (!response.ok) {
          throw new Error(`无法获取 ${currentSymbol} 的价格数据，请检查交易对名称是否正确`);
        }
        
        const data = await response.json();
        
        if (!Array.isArray(data) || data.length === 0) {
          throw new Error('无法获取价格数据');
        }
        
        // 处理数据
        processData(data);
        
        // 更新UI
        updateUI();
        
        // 显示更新时间
        document.getElementById('data-time').textContent = `数据更新时间：${new Date().toLocaleString()}`;
        
        showLoading(false);
      } catch (error) {
        console.error('获取价格数据时出错:', error);
        showLoading(false);
        alert('获取数据失败: ' + error.message);
      }
    }
    
    // 格式化交易对显示
    function formatSymbolDisplay(symbol) {
      // 如果交易对以USDT结尾，则格式化为 XXX/USDT
      if (symbol.endsWith('USDT')) {
        return `${symbol.substring(0, symbol.length - 4)}/USDT`;
      }
      return symbol;
    }
    
    // 处理API返回的数据
    function processData(data) {
      // 提取数据并反转数组，使最新日期排在前面
      const reversedData = [...data].reverse();
      priceData = reversedData.map(item => parseFloat(item[4])); // 收盘价
      const openPrices = reversedData.map(item => parseFloat(item[1])); // 开盘价
      const highPrices = reversedData.map(item => parseFloat(item[2])); // 最高价
      const lowPrices = reversedData.map(item => parseFloat(item[3])); // 最低价
      volumeData = reversedData.map(item => parseFloat(item[5])); // 成交量
      
      // 日期标签
      dateLabels = reversedData.map(item => {
        const date = new Date(parseInt(item[0]));
        return `${date.getMonth() + 1}/${date.getDate()}`;
      });
      
      // 计算涨跌幅
      const priceChanges = [];
      for (let i = 0; i < priceData.length; i++) {
        if (i === 0) {
          priceChanges.push(0); // 最新一天没有涨跌幅比较
        } else {
          const change = ((priceData[i] - priceData[i-1]) / priceData[i-1]) * 100;
          priceChanges.push(change);
        }
      }
      
      // 计算均线
      const ma3 = calculateMA(priceData, 3);
      const ma5 = calculateMA(priceData, 5);
      const ma20 = calculateMA(priceData, 20);
      const ma30 = calculateMA(priceData, 30);
      
      // 计算MA30斜率（角度）
      const ma30Slope = calculateSlopeAngle(ma30);
      
      // 计算增强技术指标
      const indicators = calculateEnhancedIndicators(priceData, highPrices, lowPrices, volumeData);
      
      // 判断趋势
      const trend = enhancedDetermineTrend(priceData, ma3, ma5, ma20, ma30, ma30Slope, indicators);
      
      // 计算动态挂单策略
      const orderStrategy = enhancedOrderStrategy(priceData, highPrices, lowPrices, trend, indicators);
      
      // 计算风险管理指标
      const riskMetrics = calculateRiskMetrics(priceData, trend, orderStrategy);
      
      // 更新趋势指示器
      updateEnhancedTrendIndicator(trend, indicators, orderStrategy, riskMetrics);
      
      // 更新显示
      document.getElementById('ma3-value').textContent = formatNumber(ma3[0], 2);
      document.getElementById('ma5-value').textContent = formatNumber(ma5[0], 2);
      document.getElementById('ma20-value').textContent = formatNumber(ma20[0], 2);
      document.getElementById('ma30-value').textContent = formatNumber(ma30[0], 2);
      
      // 更新挂单显示
      document.getElementById('long-order-display').textContent = formatNumber(orderStrategy.longOrderPrice, 2);
      document.getElementById('short-order-display').textContent = formatNumber(orderStrategy.shortOrderPrice, 2);
      document.getElementById('long-stop-loss').textContent = `止损价: ${formatNumber(orderStrategy.longStopLoss, 2)}`;
      document.getElementById('short-stop-loss').textContent = `止损价: ${formatNumber(orderStrategy.shortStopLoss, 2)}`;
      
      // 计算变化百分比（与前一天相比）
      const ma3ChangePercent = ((ma3[0] - ma3[1]) / ma3[1]) * 100;
      const ma5ChangePercent = ((ma5[0] - ma5[1]) / ma5[1]) * 100;
      const ma20ChangePercent = ((ma20[0] - ma20[1]) / ma20[1]) * 100;
      const ma30ChangePercent = ((ma30[0] - ma30[1]) / ma30[1]) * 100;
      
      // 更新变化显示
      updateChangeDisplay('ma3-change', ma3ChangePercent);
      updateChangeDisplay('ma5-change', ma5ChangePercent);
      updateChangeDisplay('ma20-change', ma20ChangePercent);
      updateChangeDisplay('ma30-change', ma30ChangePercent);
      
      // 创建或更新图表
      createOrUpdateCharts(dateLabels, priceData, ma3, ma5, ma20, ma30, volumeData);
      
      // 更新价格表格（始终显示全部30天数据）
      updatePriceTable(dateLabels, openPrices, highPrices, lowPrices, priceData, priceChanges, volumeData);
    }
    
    // 计算移动平均线
    function calculateMA(prices, period) {
      const result = [];
      
      // 从最新的数据点开始计算
      for (let i = 0; i < prices.length; i++) {
        if (i + period > prices.length) {
          // 数据点不足period天，返回null
          result.push(null);
        } else {
          let sum = 0;
          // 计算前period天的收盘价平均值（从当前i开始，向后取period天）
          for (let j = 0; j < period; j++) {
            sum += prices[i + j];
          }
          result.push(sum / period);
        }
      }
      
      return result;
    }
    
    // 计算EMA（指数移动平均）
    function calculateEMA(prices, period) {
      const ema = [];
      const multiplier = 2 / (period + 1);
      
      // 第一个EMA是简单移动平均
      let sum = 0;
      for (let i = 0; i < period; i++) {
        sum += prices[i];
      }
      ema[period - 1] = sum / period;
      
      // 计算后续EMA
      for (let i = period; i < prices.length; i++) {
        ema[i] = (prices[i] - ema[i - 1]) * multiplier + ema[i - 1];
      }
      
      return ema;
    }
    
    // 计算斜率角度（以度为单位）
    function calculateSlopeAngle(maValues) {
      // 确保有足够的数据点来计算斜率
      if (maValues.length < 2 || maValues[0] === null || maValues[1] === null) {
        return 0;
      }
      
      // 计算两天之间的差值
      const deltaY = maValues[0] - maValues[1];
      
      // 计算斜率（角度）
      const angle = Math.atan(deltaY) * (180 / Math.PI);
      return angle;
    }
    
    // 计算增强技术指标
    function calculateEnhancedIndicators(prices, highs, lows, volumes) {
      // 计算RSI
      const rsi = calculateRSI(prices, 14);
      
      // 计算MACD
      const macd = calculateMACD(prices);
      
      // 计算ATR（平均真实波幅）
      const atr = calculateATR(highs, lows, prices, 14);
      
      // 计算成交量MA
      const volumeMA = calculateMA(volumes, 20);
      const volumeConfirmation = volumes[0] > volumeMA[0] * 1.2;
      
      // 计算波动率（标准差）
      const volatility = calculateVolatility(prices, 20);
      
      return {
        rsi: rsi[rsi.length - 1],
        macd,
        atr: atr[0],
        volumeConfirmation,
        volatility: volatility[0]
      };
    }
    
    // 计算RSI指标
    function calculateRSI(prices, period = 14) {
      const gains = [];
      const losses = [];
      
      for (let i = 1; i < prices.length; i++) {
        const change = prices[i] - prices[i-1];
        gains.push(change > 0 ? change : 0);
        losses.push(change < 0 ? Math.abs(change) : 0);
      }
      
      const result = [];
      
      // 计算前period天的平均值
      let avgGain = gains.slice(0, period).reduce((a, b) => a + b, 0) / period;
      let avgLoss = losses.slice(0, period).reduce((a, b) => a + b, 0) / period;
      
      // 第一个RSI值
      let rs = avgGain / avgLoss;
      result.push(100 - (100 / (1 + rs)));
      
      // 计算后续RSI值
      for (let i = period; i < gains.length; i++) {
        avgGain = (avgGain * (period - 1) + gains[i]) / period;
        avgLoss = (avgLoss * (period - 1) + losses[i]) / period;
        
        rs = avgGain / avgLoss;
        result.push(100 - (100 / (1 + rs)));
      }
      
      return result;
    }
    
    // 计算MACD指标
    function calculateMACD(prices) {
      const ema12 = calculateEMA(prices, 12);
      const ema26 = calculateEMA(prices, 26);
      
      // 确保数组长度一致
      const startIndex = Math.max(ema12.length - prices.length, 0);
      const macdLine = [];
      
      for (let i = startIndex; i < ema12.length; i++) {
        if (ema12[i] && ema26[i]) {
          macdLine.push(ema12[i] - ema26[i]);
        }
      }
      
      const signalLine = calculateEMA(macdLine, 9);
      const histogram = macdLine.map((val, idx) => val - signalLine[idx]);
      
      return {
        macdLine: macdLine[macdLine.length - 1],
        signalLine: signalLine[signalLine.length - 1],
        histogram: histogram[histogram.length - 1],
        isBullish: macdLine[macdLine.length - 1] > signalLine[signalLine.length - 1]
      };
    }
    
    // 计算ATR（平均真实波幅）
    function calculateATR(highs, lows, closes, period) {
      const trueRanges = [];
      
      for (let i = 1; i < highs.length; i++) {
        const tr1 = highs[i] - lows[i]; // 当日最高-最低
        const tr2 = Math.abs(highs[i] - closes[i-1]); // 当日最高-前日收盘
        const tr3 = Math.abs(lows[i] - closes[i-1]); // 当日最低-前日收盘
        
        trueRanges.push(Math.max(tr1, tr2, tr3));
      }
      
      // 计算ATR
      const atr = [];
      let sum = 0;
      
      // 第一个ATR是前period个TR的平均值
      for (let i = 0; i < period; i++) {
        sum += trueRanges[i];
      }
      atr.push(sum / period);
      
      // 计算后续ATR
      for (let i = period; i < trueRanges.length; i++) {
        atr.push((atr[i-period] * (period - 1) + trueRanges[i]) / period);
      }
      
      return atr;
    }
    
    // 计算波动率（标准差）
    function calculateVolatility(prices, period) {
      const result = [];
      
      for (let i = 0; i <= prices.length - period; i++) {
        const slice = prices.slice(i, i + period);
        const mean = slice.reduce((a, b) => a + b, 0) / period;
        const variance = slice.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / period;
        result.push(Math.sqrt(variance));
      }
      
      return result;
    }
    
    // 增强趋势判断
    function enhancedDetermineTrend(prices, ma3, ma5, ma20, ma30, ma30Slope, indicators) {
      const {
        rsi,
        macd,
        volumeConfirmation
      } = indicators;
      
      // 基础条件（原有逻辑）
      const baseBullish = 
        prices[0] > ma30[0] && 
        prices[1] > ma30[1] && 
        prices[2] > ma30[2] && 
        ma30Slope > 15;
      
      const baseBearish = 
        prices[0] < ma30[0] && 
        prices[1] < ma30[1] && 
        prices[2] < ma30[2] && 
        ma30Slope < -15;
      
      // 均线排列条件
      const maAlignmentBullish = ma3[0] > ma5[0] && ma5[0] > ma20[0]; // 多头排列
      const maAlignmentBearish = ma3[0] < ma5[0] && ma5[0] < ma20[0]; // 空头排列
      
      // RSI条件
      const rsiBullish = rsi > 50 && rsi < 70; // RSI在健康多头区间
      const rsiBearish = rsi < 50 && rsi > 30; // RSI在健康空头区间
      
      // 增强的多头条件
      const enhancedBullish = baseBullish && 
        maAlignmentBullish && // 均线多头排列
        rsiBullish && // RSI在健康区间
        macd.isBullish && // MACD金叉
        volumeConfirmation; // 成交量确认
      
      // 增强的空头条件
      const enhancedBearish = baseBearish && 
        maAlignmentBearish && // 均线空头排列
        rsiBearish && // RSI在健康区间
        !macd.isBullish && // MACD死叉
        volumeConfirmation; // 成交量确认
      
      // 震荡市条件
      const isConsolidating = 
        Math.abs(ma30Slope) < 10 && // 斜率平缓
        Math.abs(prices[0] - ma30[0]) / ma30[0] < 0.03; // 价格在MA30附近3%以内
      
      if (enhancedBullish) {
        return {
          type: 'bullish',
          confidence: calculateConfidence('bullish', indicators, ma30Slope),
          message: '多重指标确认多头趋势：均线多头排列 + RSI健康 + MACD金叉 + 成交量确认'
        };
      } else if (enhancedBearish) {
        return {
          type: 'bearish',
          confidence: calculateConfidence('bearish', indicators, ma30Slope),
          message: '多重指标确认空头趋势：均线空头排列 + RSI健康 + MACD死叉 + 成交量确认'
        };
      } else if (isConsolidating) {
        return {
          type: 'consolidating',
          confidence: 0.6,
          message: '市场处于震荡整理阶段'
        };
      } else {
        return {
          type: 'neutral',
          confidence: 0.5,
          message: '趋势不明，建议观望'
        };
      }
    }
    
    // 计算趋势置信度
    function calculateConfidence(trendType, indicators, ma30Slope) {
      let confidence = 0.5; // 基础置信度
      
      // 根据多个指标调整置信度
      if (indicators.volumeConfirmation) confidence += 0.2;
      if (Math.abs(ma30Slope) > 20) confidence += 0.15;
      
      // RSI在健康区间加分
      if ((trendType === 'bullish' && indicators.rsi > 50 && indicators.rsi < 70) ||
          (trendType === 'bearish' && indicators.rsi < 50 && indicators.rsi > 30)) {
        confidence += 0.15;
      }
      
      // MACD方向正确加分
      if ((trendType === 'bullish' && indicators.macd.isBullish) ||
          (trendType === 'bearish' && !indicators.macd.isBullish)) {
        confidence += 0.1;
      }
      
      return Math.min(confidence, 0.95); // 最大95%置信度
    }
    
    // 增强挂单策略
    function enhancedOrderStrategy(prices, highs, lows, trend, indicators) {
      const atr = indicators.atr;
      const currentPrice = prices[0];
      
      // 寻找支撑位和阻力位
      const supportLevel = findSupportLevel(prices, lows);
      const resistanceLevel = findResistanceLevel(prices, highs);
      
      // 动态调整挂单距离（基于ATR）
      const dynamicLongDistance = atr * 0.5;
      const dynamicShortDistance = atr * 0.3;
      
      let longOrderPrice, shortOrderPrice, longStopLoss, shortStopLoss;
      
      if (trend.type === 'bullish') {
        // 多头趋势中，在支撑位下方挂单
        longOrderPrice = supportLevel - dynamicLongDistance;
        longStopLoss = longOrderPrice - atr * 1.5;
        shortOrderPrice = null;
        shortStopLoss = null;
      } else if (trend.type === 'bearish') {
        // 空头趋势中，在阻力位上方挂单
        shortOrderPrice = resistanceLevel + dynamicShortDistance;
        shortStopLoss = shortOrderPrice + atr * 1.5;
        longOrderPrice = null;
        longStopLoss = null;
      } else {
        // 震荡市中双向挂单
        longOrderPrice = supportLevel - dynamicLongDistance;
        longStopLoss = longOrderPrice - atr * 1.5;
        shortOrderPrice = resistanceLevel + dynamicShortDistance;
        shortStopLoss = shortOrderPrice + atr * 1.5;
      }
      
      return {
        longOrderPrice,
        shortOrderPrice,
        longStopLoss,
        shortStopLoss,
        atrDistance: atr
      };
    }
    
    // 寻找支撑位（简化版）
    function findSupportLevel(prices, lows) {
      // 取最近10天的最低点作为支撑位
      const recentLows = lows.slice(0, 10);
      return Math.min(...recentLows);
    }
    
    // 寻找阻力位（简化版）
    function findResistanceLevel(prices, highs) {
      // 取最近10天的最高点作为阻力位
      const recentHighs = highs.slice(0, 10);
      return Math.max(...recentHighs);
    }
    
    // 计算风险管理指标
    function calculateRiskMetrics(prices, trend, orderStrategy) {
      const volatility = calculateVolatility(prices, 20);
      const currentVolatility = volatility[0];
      
      return {
        volatility: currentVolatility,
        atr: orderStrategy.atrDistance,
        riskLevel: assessRiskLevel(currentVolatility, trend.confidence)
      };
    }
    
    // 评估风险等级
    function assessRiskLevel(volatility, confidence) {
      if (volatility > 100 && confidence < 0.7) return '高风险';
      if (volatility > 50 && confidence < 0.8) return '中高风险';
      if (volatility > 20 && confidence < 0.9) return '中等风险';
      return '低风险';
    }
    
    // 更新增强趋势指示器
    function updateEnhancedTrendIndicator(trend, indicators, orderStrategy, riskMetrics) {
      const indicator = document.getElementById('trend-indicator');
      const status = document.getElementById('trend-status');
      const description = document.getElementById('trend-description');
      const bullishMet = document.getElementById('bullish-met');
      const bearishMet = document.getElementById('bearish-met');
      const confidenceBar = document.getElementById('confidence-bar');
      const confidenceValue = document.getElementById('confidence-value');
      
      // 移除所有趋势类
      indicator.classList.remove('bullish', 'bearish', 'neutral');
      
      // 添加当前趋势类
      indicator.classList.add(trend.type);
      
      // 更新状态文本和颜色
      if (trend.type === 'bullish') {
        status.textContent = '多头趋势';
        status.className = 'text-4xl font-bold text-bullish';
        bullishMet.textContent = '已满足';
        bullishMet.className = 'mt-2 text-xs text-bullish';
        bearishMet.textContent = '未满足';
        bearishMet.className = 'mt-2 text-xs text-gray-500';
      } else if (trend.type === 'bearish') {
        status.textContent = '空头趋势';
        status.className = 'text-4xl font-bold text-bearish';
        bullishMet.textContent = '未满足';
        bullishMet.className = 'mt-2 text-xs text-gray-500';
        bearishMet.textContent = '已满足';
        bearishMet.className = 'mt-2 text-xs text-bearish';
      } else {
        status.textContent = '震荡趋势';
        status.className = 'text-4xl font-bold text-neutral';
        bullishMet.textContent = '未满足';
        bullishMet.className = 'mt-2 text-xs text-gray-500';
        bearishMet.textContent = '未满足';
        bearishMet.className = 'mt-2 text-xs text-gray-500';
      }
      
      // 更新描述
      description.textContent = trend.message;
      
      // 更新技术指标显示
      document.getElementById('rsi-value').textContent = indicators.rsi.toFixed(2);
      document.getElementById('macd-status').textContent = indicators.macd.isBullish ? '金叉' : '死叉';
      document.getElementById('volume-confirm').textContent = indicators.volumeConfirmation ? '是' : '否';
      document.getElementById('volatility').textContent = formatNumber(riskMetrics.volatility, 2);
      document.getElementById('atr-value').textContent = formatNumber(indicators.atr, 2);
      
      // 更新置信度
      const confidencePercent = Math.round(trend.confidence * 100);
      confidenceBar.style.width = `${confidencePercent}%`;
      confidenceValue.textContent = `${confidencePercent}%`;
      
      // 根据置信度调整颜色
      if (confidencePercent >= 80) {
        confidenceBar.className = 'confidence-bar bg-green-600 h-2.5 rounded-full';
      } else if (confidencePercent >= 60) {
        confidenceBar.className = 'confidence-bar bg-yellow-500 h-2.5 rounded-full';
      } else {
        confidenceBar.className = 'confidence-bar bg-red-500 h-2.5 rounded-full';
      }
      
      // 更新挂单价
      document.getElementById('long-order-price').textContent = orderStrategy.longOrderPrice ? formatNumber(orderStrategy.longOrderPrice, 2) : '--';
      document.getElementById('short-order-price').textContent = orderStrategy.shortOrderPrice ? formatNumber(orderStrategy.shortOrderPrice, 2) : '--';
      document.getElementById('long-order-description').textContent = `ATR: ${formatNumber(orderStrategy.atrDistance, 2)}`;
      document.getElementById('short-order-description').textContent = `ATR: ${formatNumber(orderStrategy.atrDistance, 2)}`;
    }
    
    // 更新变化显示
    function updateChangeDisplay(elementId, percent) {
      const element = document.getElementById(elementId);
      const percentText = percent.toFixed(2) + '%';
      
      if (percent > 0) {
        element.innerHTML = `<span class="text-gray-500">较昨日: </span><span class="text-green-500">+${percentText}</span>`;
      } else if (percent < 0) {
        element.innerHTML = `<span class="text-gray-500">较昨日: </span><span class="text-red-500">${percentText}</span>`;
      } else {
        element.innerHTML = `<span class="text-gray-500">较昨日: </span><span>${percentText}</span>`;
      }
    }
    
    // 创建或更新图表
    function createOrUpdateCharts(labels, prices, ma3, ma5, ma20, ma30, volumes) {
      const priceCtx = document.getElementById('priceChart').getContext('2d');
      const volumeCtx = document.getElementById('volumeChart').getContext('2d');
      
      // 如果价格图表已存在，销毁它
      if (priceChart) {
        priceChart.destroy();
      }
      
      // 创建价格图表
      priceChart = new Chart(priceCtx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: '收盘价',
              data: prices,
              borderColor: '#3B82F6',
              backgroundColor: 'rgba(59, 130, 246, 0.1)',
              borderWidth: 2,
              pointRadius: 2,
              fill: false,
              tension: 0.2,
              order: 4
            },
            {
              label: 'MA3',
              data: ma3,
              borderColor: '#F59E0B',
              borderWidth: 2,
              pointRadius: 0,
              fill: false,
              tension: 0.4,
              order: 3
            },
            {
              label: 'MA5',
              data: ma5,
              borderColor: '#3B82F6',
              borderWidth: 2,
              pointRadius: 0,
              fill: false,
              tension: 0.4,
              order: 2
            },
            {
              label: 'MA20',
              data: ma20,
              borderColor: '#10B981',
              borderWidth: 2,
              pointRadius: 0,
              fill: false,
              tension: 0.4,
              order: 1
            },
            {
              label: 'MA30',
              data: ma30,
              borderColor: '#8B5CF6',
              borderWidth: 2,
              pointRadius: 0,
              fill: false,
              tension: 0.4,
              order: 0
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false,
          },
          plugins: {
            legend: {
              position: 'top',
              labels: {
                usePointStyle: true,
                boxWidth: 6
              }
            },
            tooltip: {
              backgroundColor: 'rgba(255, 255, 255, 0.9)',
              titleColor: '#1F2937',
              bodyColor: '#1F2937',
              borderColor: '#E5E7EB',
              borderWidth: 1,
              padding: 12,
              boxPadding: 6,
              usePointStyle: true,
              callbacks: {
                label: function(context) {
                  let label = context.dataset.label || '';
                  if (label) {
                    label += ': ';
                  }
                  if (context.parsed.y !== null) {
                    label += new Intl.NumberFormat('en-US', { 
                      style: 'currency', 
                      currency: 'USD',
                      maximumFractionDigits: 2
                    }).format(context.parsed.y);
                  }
                  return label;
                }
              }
            }
          },
          scales: {
            x: {
              grid: {
                display: false
              },
              ticks: {
                maxRotation: 0,
                autoSkip: true,
                maxTicksLimit: 10
              }
            },
            y: {
              position: 'right',
              grid: {
                color: 'rgba(0, 0, 0, 0.05)'
              },
              ticks: {
                callback: function(value) {
                  return '$' + value.toLocaleString();
                }
              }
            }
          }
        }
      });
      
      // 如果成交量图表已存在，销毁它
      if (volumeChart) {
        volumeChart.destroy();
      }
      
      // 创建成交量图表
      volumeChart = new Chart(volumeCtx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: '成交量',
            data: volumes,
            backgroundColor: volumes.map((v, i) => i > 0 && priceData[i] > priceData[i-1] ? 'rgba(16, 185, 129, 0.7)' : 'rgba(239, 68, 68, 0.7)'),
            borderWidth: 0,
            borderRadius: 2,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false,
          },
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              backgroundColor: 'rgba(255, 255, 255, 0.9)',
              titleColor: '#1F2937',
              bodyColor: '#1F2937',
              borderColor: '#E5E7EB',
              borderWidth: 1,
              padding: 12,
              boxPadding: 6,
              usePointStyle: true,
              callbacks: {
                label: function(context) {
                  let label = context.dataset.label || '';
                  if (label) {
                    label += ': ';
                  }
                  if (context.parsed.y !== null) {
                    label += context.parsed.y.toLocaleString() + ' BTC';
                  }
                  return label;
                }
              }
            }
          },
          scales: {
            x: {
              grid: {
                display: false
              },
              ticks: {
                display: false
              }
            },
            y: {
              position: 'right',
              grid: {
                color: 'rgba(0, 0, 0, 0.05)'
              },
              ticks: {
                callback: function(value) {
                  if (value >= 1000) {
                    return (value / 1000) + 'K';
                  }
                  return value;
                }
              }
            }
          }
        }
      });
    }
    
    // 更新价格表格
    function updatePriceTable(dates, opens, highs, lows, closes, changes, volumes) {
      const tableBody = document.getElementById('price-table-body');
      tableBody.innerHTML = '';
      
      // 显示全部30天数据
      for (let i = 0; i < dates.length; i++) {
        const row = document.createElement('tr');
        row.className = i % 2 === 0 ? 'bg-white' : 'bg-gray-50';
        
        // 日期
        const dateCell = document.createElement('td');
        dateCell.className = 'px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900';
        dateCell.textContent = dates[i];
        row.appendChild(dateCell);
        
        // 开盘价
        const openCell = document.createElement('td');
        openCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
        openCell.textContent = formatNumber(opens[i], 2);
        row.appendChild(openCell);
        
        // 最高价
        const highCell = document.createElement('td');
        highCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
        highCell.textContent = formatNumber(highs[i], 2);
        row.appendChild(highCell);
        
        // 最低价
        const lowCell = document.createElement('td');
        lowCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500';
        lowCell.textContent = formatNumber(lows[i], 2);
        row.appendChild(lowCell);
        
        // 收盘价
        const closeCell = document.createElement('td');
        closeCell.className = 'px-6 py-4 whitespace-nowrap text-sm font-medium';
        closeCell.textContent = formatNumber(closes[i], 2);
        row.appendChild(closeCell);
        
        // 涨跌幅
        const changeCell = document.createElement('td');
        changeCell.className = 'px-6 py-4 whitespace-nowrap text-sm font-medium';
        if (i < changes.length - 1) {
          const changePercent = changes[i];
          changeCell.textContent = changePercent > 0 ? `+${changePercent.toFixed(2)}%` : `${changePercent.toFixed(2)}%`;
          changeCell.className += changePercent > 0 ? ' text-green-600' : ' text-red-600';
        } else {
          changeCell.textContent = '-';
        }
        row.appendChild(changeCell);
        
        // 成交量
        const volumeCell = document.createElement('td');
        volumeCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-500 volume-column';
        volumeCell.textContent = formatNumber(volumes[i], 0);
        row.appendChild(volumeCell);
        
        tableBody.appendChild(row);
      }
      
      // 切换成交量列的显示状态
      toggleVolumeColumn(showVolumeColumn);
    }
    
    // 切换成交量列的显示
    function toggleVolumeColumn(forceState) {
      showVolumeColumn = typeof forceState === 'boolean' ? forceState : !showVolumeColumn;
      const volumeColumns = document.querySelectorAll('.volume-column');
      
      if (showVolumeColumn) {
        volumeColumns.forEach(col => col.style.display = 'table-cell');
        document.getElementById('toggle-volume-btn').innerHTML = '<i class="fa fa-area-chart mr-1"></i>成交量';
      } else {
        volumeColumns.forEach(col => col.style.display = 'none');
        document.getElementById('toggle-volume-btn').innerHTML = '<i class="fa fa-area-chart mr-1"></i>显示成交量';
      }
    }
    
    // 格式化数字
    function formatNumber(num, decimals) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: decimals,
        maximumFractionDigits: decimals
      }).format(num);
    }
    
    // 显示/隐藏加载状态
    function showLoading(isLoading) {
      const fetchBtn = document.getElementById('fetch-btn');
      const refreshBtn = document.getElementById('refresh-btn');
      
      if (isLoading) {
        fetchBtn.disabled = true;
        fetchBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>加载中...';
        refreshBtn.disabled = true;
        refreshBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i>加载中...';
      } else {
        fetchBtn.disabled = false;
        fetchBtn.innerHTML = '<i class="fa fa-search mr-2"></i>获取数据';
        refreshBtn.disabled = false;
        refreshBtn.innerHTML = '<i class="fa fa-refresh mr-2"></i>刷新数据';
      }
    }
    
    // 更新UI
    function updateUI() {
      // 添加动画效果
      const cards = document.querySelectorAll('.card-shadow');
      cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
          card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
          card.style.opacity = '1';
          card.style.transform = 'translateY(0)';
        }, 100 * index);
      });
      
      // 为趋势指示器添加动画
      const trendIndicator = document.getElementById('trend-indicator');
      trendIndicator.style.opacity = '0';
      trendIndicator.style.transform = 'translateY(20px)';
      
      setTimeout(() => {
        trendIndicator.style.transition = 'opacity 0.5s ease, transform 0.5s ease, background-color 0.5s ease, border-color 0.5s ease';
        trendIndicator.style.opacity = '1';
        trendIndicator.style.transform = 'translateY(0)';
      }, 500);
    }
  </script>
</body>
</html>
